import{_ as n,a as s}from"./app.c89a8060.js";var a="/assets/01.bafe021a.jpg",t="/assets/01-event.a5410c18.jpg";const p={},e=s('<h1 id="\u5728\u4E0D\u540C\u7A97\u53E3\u4E4B\u9593\u50B3\u905E\u8CC7\u8A0A-window-postmessage" tabindex="-1"><a class="header-anchor" href="#\u5728\u4E0D\u540C\u7A97\u53E3\u4E4B\u9593\u50B3\u905E\u8CC7\u8A0A-window-postmessage" aria-hidden="true">#</a> \u5728\u4E0D\u540C\u7A97\u53E3\u4E4B\u9593\u50B3\u905E\u8CC7\u8A0A window.postMessage()</h1><p>\u56E0\u70BA\u6848\u5B50\u7684\u95DC\u4FC2\uFF0C\u9047\u5230\u9019\u6A23\u7684\u60C5\u5883:</p><p><img src="'+a+`" alt="\u60C5\u5883\u793A\u610F\u5716"></p><p>\u5728 app (ios / android) \u4E2D\u5D4C\u5165 webview (\u767D\u8272\u5340\u584A)\uFF0C \u5728 webview \u4E2D\u53C8\u6709\u9700\u8981\u8DDF app \u4E92\u52D5\u7684 button (\u5305\u542B\u53F3\u4E0A\u89D2\u7684 X)\uFF0C \u7D05\u8272\u7684 button \u90FD\u662F\u9700\u8981\u548C app \u4E92\u52D5\u7684\u3002 \u5728\u756B\u9762\u4E0A button \u5FC5\u9808\u662F\u5C6C\u65BC webview \u5BE6\u4F5C\uFF0C\u800C\u908F\u8F2F\u537B\u53C8\u662F app \u5F97\u8CA0\u8CAC\u7684\u3002</p><p><s>\u96D6\u7136\u53EF\u80FD\u53EF\u4EE5\u4F7F\u7528\u5716\u5C64\u628A webview \u593E\u5728\u4E2D\u9593\uFF0C\u8B93 button \u5C6C\u65BC app\uFF0C\u4F46...\u6709\u9EDE\u7CD9\u3002</s></p><h4 id="\u9019\u6642\u5019\u53EF\u4EE5\u4F7F\u7528-window-postmessage-\u5728\u300C\u4E0D\u540C\u7A97\u53E3\u300D\u4E4B\u9593\u9032\u884C\u300C\u8DE8\u4F86\u6E90\u6E9D\u901A\u300D" tabindex="-1"><a class="header-anchor" href="#\u9019\u6642\u5019\u53EF\u4EE5\u4F7F\u7528-window-postmessage-\u5728\u300C\u4E0D\u540C\u7A97\u53E3\u300D\u4E4B\u9593\u9032\u884C\u300C\u8DE8\u4F86\u6E90\u6E9D\u901A\u300D" aria-hidden="true">#</a> \u9019\u6642\u5019\u53EF\u4EE5\u4F7F\u7528 <code>window.postMessage()</code> \u5728\u300C\u4E0D\u540C\u7A97\u53E3\u300D\u4E4B\u9593\u9032\u884C\u300C\u8DE8\u4F86\u6E90\u6E9D\u901A\u300D</h4><p>\u8209\u4F8B:</p><ol><li>\u4F60\u7684\u7DB2\u9801 &lt;-&gt; iframe \u88E1\u7684\u7DB2\u9801</li><li>\u4F60\u7684\u7DB2\u9801 &lt;-&gt; app ( ios/android )</li></ol><blockquote><p>The window.postMessage() method safely enables cross-origin communication between Window objects; e.g., between a page and a pop-up that it spawned, or between a page and an iframe embedded within it.</p></blockquote><hr><h3 id="\u767C\u9001\u65B9" tabindex="-1"><a class="header-anchor" href="#\u767C\u9001\u65B9" aria-hidden="true">#</a> \u767C\u9001\u65B9:</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>targetWindow<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> targetOrigin<span class="token punctuation">)</span>
targetWindow<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> targetOrigin<span class="token punctuation">,</span> <span class="token punctuation">[</span>transfer<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>targetWindow: <strong>\u76EE\u6A19\u7A97\u53E3</strong></li><li>message: \u5C31\u662F\u8981\u50B3\u7684\u8CC7\u6599</li><li>targetOrigin: \u6307\u5B9A\u76EE\u6A19\u7A97\u53E3\u7684\u4F86\u6E90\uFF0C\u53EA\u6709\u5728\u76EE\u6A19\u7A97\u53E3\u7684 origin \u7B26\u5408 targetOrigin \u6240\u6307\u5B9A\u6642\u624D\u6703\u4F5C\u7528\uFF0C \u907F\u514D\u5C0D\u8457\u932F\u8AA4\u7684\u76EE\u6A19\u7A97\u53E3\u8AA4\u50B3\u8CC7\u8A0A\uFF0C<strong>\u5343\u842C</strong>\u4E0D\u8981\u5077\u61F6\u4F7F\u7528 <code>*</code></li></ul><blockquote><p>If at the time the event is scheduled to be dispatched the scheme, hostname, or port of targetWindow&#39;s document does not match that provided in targetOrigin, the event will not be dispatched; only if all three match will the event be dispatched <strong>Always provide a specific targetOrigin, not *, if you know where the other window&#39;s document should be located. Failing to provide a specific target discloses the data you send to any interested malicious site.</strong></p></blockquote><h3 id="\u63A5\u6536\u65B9" tabindex="-1"><a class="header-anchor" href="#\u63A5\u6536\u65B9" aria-hidden="true">#</a> \u63A5\u6536\u65B9:</h3><p>\u5982\u679C\u63A5\u6536\u65B9\u662F web\uFF0C\u5247\u662F\u7528 <code>addEventListener</code> \u76E3\u807D <code>message</code>\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// MDN</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">&#39;message&#39;</span><span class="token punctuation">,</span>
  <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u9A57\u8B49\u4F86\u6E90</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>origin <span class="token operator">!==</span> <span class="token string">&#39;http://example.org:8080&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="`+t+`" alt="messageEventObject"></p><ul><li>\u7528 origin \u4F86\u9A57\u8B49\u4F86\u6E90\u3002</li><li>data \u5C31\u662F\u50B3\u904E\u4F86\u7684\u8CC7\u8A0A\u3002</li><li>source \u5247\u662F\u767C\u9001\u65B9\uFF0C\u53EF\u4EE5\u8F15\u6613\u5730\u5F9E source \u53D6\u5F97\u767C\u9001\u65B9\u7684\u4F4D\u7F6E\uFF0C\u9032\u800C\u505A\u96D9\u5411\u6E9D\u901A\u3002</li></ul><hr><p>\u53EF\u4EE5\u958B\u555F\u5169\u500B local http server \u505A Demo</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- sender html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iframe-button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>iframe page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;iframe-button&#39;</span><span class="token punctuation">)</span>
    btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>btn<span class="token punctuation">.</span>count<span class="token punctuation">)</span> btn<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>
      btn<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
      window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>btn<span class="token punctuation">.</span>count<span class="token punctuation">,</span> <span class="token string">&#39;http://localhost:5500&#39;</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;clicked!&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- reciver.html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>counter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>counter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:5500/test.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">frameborder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;iframe-button&#39;</span><span class="token punctuation">)</span>
    btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>btn<span class="token punctuation">.</span>count<span class="token punctuation">)</span> btn<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>
      btn<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
      window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>btn<span class="token punctuation">.</span>count<span class="token punctuation">,</span> <span class="token string">&#39;http://localhost:5500&#39;</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;clicked!&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div>`,23);function o(c,l){return e}var i=n(p,[["render",o]]);export{i as default};
