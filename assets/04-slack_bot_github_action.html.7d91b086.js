import{_ as o,r as l,o as p,c,b as n,d as e,F as u,e as s,a as t}from"./app.c89a8060.js";var r="/assets/2022-02-11-01-06-23.0d19b8f6.png",i="/assets/2022-02-11-01-07-37.d1b4797b.png",b="/assets/2022-02-11-01-09-00.44c2c0b4.png",m="/assets/2022-02-11-00-42-33.ca87211e.png";const h={},k=n("h1",{id:"\u600E\u9EBC\u5728-github-action-flow-\u904B\u4F5C\u6642-\u767C\u9001\u8A0A\u606F\u5230-slack-channel",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u600E\u9EBC\u5728-github-action-flow-\u904B\u4F5C\u6642-\u767C\u9001\u8A0A\u606F\u5230-slack-channel","aria-hidden":"true"},"#"),s(" \u600E\u9EBC\u5728 Github action flow \u904B\u4F5C\u6642\uFF0C\u767C\u9001\u8A0A\u606F\u5230 Slack Channel?")],-1),_=n("p",null,"\u5DE5\u4F5C\u4E2D\u63A5\u5230\u7684\u4EFB\u52D9\uFF1A\u8981\u5728\u6BCF\u6B21 push\u3001deploy \u7684 github action \u88E1\u9762\u52A0\u5165 Slack bot \u5728\u6307\u5B9A Slack Channel \u51FA\u73FE\u901A\u77E5\u3002",-1),d=s("Slack \u5B98\u65B9\u5176\u5BE6\u5DF2\u7D93\u505A\u51FA\u5F88\u591A integration/api \u53EF\u4EE5\u4F7F\u7528\uFF0C \u4E4B\u524D\u516C\u53F8\u7684\u524D\u8F29\u662F\u4F7F\u7528\uFF0C"),g={href:"https://github.com/rtCamp/action-slack-notify",target:"_blank",rel:"noopener noreferrer"},q=s("rtCamp \u505A\u7684 Github action"),y=s(" \u7528\u7684\u662F "),f={href:"https://lubn.slack.com/apps/A0F7XDUAZ-incoming-webhooks?tab=more_info",target:"_blank",rel:"noopener noreferrer"},S=s("Incoming WebHooks"),v=s(" \u9019\u500B Slack app\u3002"),x=n("p",null,"\u800C\u63DB\u6211\u8981\u4F86\u5EFA\u7F6E\u65B0\u5C08\u6848\u7684\u6642\u5019\u770B\u5230\u9019\u6BB5",-1),A=n("blockquote",null,[n("p",null,"Please note, this is a legacy custom integration - an outdated way for teams to integrate with Slack. These integrations lack newer features and they will be deprecated and possibly removed in the future. We do not recommend their use. Instead, we suggest that you check out their replacement: Slack apps.")],-1),w=n("p",null,"\u96D6\u7136\u6C92\u6709\u8AAA\u4EC0\u9EBC\u6642\u5019\u6703\u771F\u7684\u88AB\u5EE2\u68C4\u6389\uFF0C\u4F46\u60F3\u5230\u4EE5\u5F8C\u53EF\u80FD\u53C8\u8981\u5728\u8A2D\u5B9A\u4E00\u6B21\u5C31\u89BA\u5F97\u9EBB\u7169\uFF0C \u4E7E\u8106\u4E00\u6B21\u5C31\u5148\u5F04\u597D\uFF0C \u6240\u4EE5\u958B\u59CB\u6D77\u91CF\u641C\u5C0B\uFF0C\u9019\u7A2E\u5C0F\u6771\u897F\u7684\u8CC7\u6E90\u771F\u7684\u90FD\u6BD4\u8F03\u5C11\u554A\u3002",-1),N=s("\u627E\u5230\u9019\u500B "),T={href:"https://github.com/slackapi/slack-github-action",target:"_blank",rel:"noopener noreferrer"},C=s("Slack api official repo"),K=n("p",null,"\u63A1\u7528\u7B2C\u4E8C\u7A2E\u65B9\u5F0F - Technique 2: Slack App",-1),B=n("p",null,"\u7167\u8457\u505A\u4E00\u6B21\u5C31\u641E\u5B9A\uFF0C \u6574\u500B\u8A2D\u5B9A\u5927\u6982 5 \u5206\u9418\u7D50\u675F\u3002",-1),O=n("p",null,"\u4EE5\u4E0B\u55AE\u7D14\u628A\u6587\u4EF6\u8D85\u7D1A\u7C21\u55AE\u7FFB\u8B6F\u4E00\u4E0B",-1),$=n("h2",{id:"technique-2-slack-app",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#technique-2-slack-app","aria-hidden":"true"},"#"),s(" Technique 2: Slack App")],-1),L=s("\u9996\u5148\u8981\u5148\u5EFA\u7ACB\u6216\u8005\u4F7F\u7528\u65E2\u6709\u7684 Slack app\uFF0C \u7528\u9019\u500B app \u4F86\u8ABF\u7528 "),E={href:"https://api.slack.com/methods/chat.postMessage",target:"_blank",rel:"noopener noreferrer"},G=s("chat.postMessage"),I=s(" API method\uFF0C"),F=n("h3",{id:"setup",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#setup","aria-hidden":"true"},"#"),s(" Setup")],-1),H={href:"https://api.slack.com/apps",target:"_blank",rel:"noopener noreferrer"},P=s("\u5EFA\u7ACB Slack App"),j=n("img",{src:r,alt:""},null,-1),D=n("img",{src:i,alt:""},null,-1),M=s(" \u5148\u9078\u64C7 "),U=n("code",null,"From scratch",-1),R=s(" \u5C31\u53EF\u4EE5\u4E86"),V=s("\u628A "),W={href:"https://api.slack.com/scopes/chat:write",target:"_blank",rel:"noopener noreferrer"},J=n("code",null,"chat.write",-1),X=s(" \u9019\u9805 \u6A5F\u5668\u4EBA\u6B0A\u9650\u7BC4\u570D\uFF08bot scope\uFF09\u52A0\u5230 "),Z=n("strong",null,"OAuth & Permissions",-1),z=s(" \u5E95\u4E0B "),Q=n("img",{src:b,alt:""},null,-1),Y=n("li",null,"\u5B89\u88DD\u5230\u76EE\u6A19 Slack workspace\uFF08Install the app to your workspace.\uFF09",-1),nn=s("\u5F9E "),sn=n("strong",null,"OAuth & Permissions",-1),an=s(" \u8907\u88FD "),en=n("code",null,"Bot Token",-1),tn=s(" \u7136\u5F8C "),on={href:"https://docs.github.com/en/free-pro-team@latest/actions/reference/encrypted-secrets#creating-encrypted-secrets-for-a-repository",target:"_blank",rel:"noopener noreferrer"},ln=s("\u52A0\u5230 Github repo - secret"),pn=s(" \u547D\u540D\u70BA "),cn=n("code",null,"SLACK_BOT_TOKEN",-1),un=s("\u3002"),rn=n("s",null,[s("\u7576\u7136\u5982\u679C\u4F60\u7684 repo \u662F "),n("code",null,"private"),s(" \u4E14\u4FDD\u8B49\u4E0D\u6703\u6709\u5176\u4ED6\u4EBA\u770B\u5230\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u76F4\u63A5\u628A token \u8CBC\u5230 github action flow \u7684 "),n("code",null,".yaml"),s(" \u88E1\u9762(?)")],-1),bn=n("li",null,[s("\u628A\u6A5F\u5668\u4EBA\u52A0\u5230\u4F60\u8981\u767C\u9001\u8A0A\u606F\u7684 Channel \u88E1\u9762 ("),n("code",null,"/invite @bot_user_name"),s(").")],-1),mn=t(`<h3 id="usage" tabindex="-1"><a class="header-anchor" href="#usage" aria-hidden="true">#</a> Usage</h3><p>\u628A\u9019\u6BB5 Action <a href="job-step">step</a> \u52A0\u5230\u4F60\u7684 GitHub Action Workflow file</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Post to a Slack channel
  <span class="token key atrule">id</span><span class="token punctuation">:</span> slack
  <span class="token key atrule">uses</span><span class="token punctuation">:</span> slackapi/slack<span class="token punctuation">-</span>github<span class="token punctuation">-</span>action@v1.18.0
  <span class="token key atrule">with</span><span class="token punctuation">:</span>
    <span class="token comment"># Slack channel id, channel name, or user id to post message.</span>
    <span class="token comment"># See also: https://api.slack.com/methods/chat.postMessage#channels</span>
    <span class="token key atrule">channel-id</span><span class="token punctuation">:</span> <span class="token string">&#39;CHANNEL_ID&#39;</span>
    <span class="token comment"># For posting a simple plain text message</span>
    <span class="token key atrule">slack-message</span><span class="token punctuation">:</span> <span class="token string">&quot;GitHub build result: \${{ job.status }}\\n\${{ github.event.pull_request.html_url || github.event.head_commit.url }}&quot;</span>
  <span class="token key atrule">env</span><span class="token punctuation">:</span>
    <span class="token key atrule">SLACK_BOT_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.SLACK_BOT_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u53EF\u4EE5\u7528 JSON \u7684\u683C\u5F0F\u53EF\u4EE5\u53BB\u81EA\u8A02\u8A0A\u606F\u5167\u5BB9\u3002 \u5728 Slack \u7684\u4E16\u754C\u88E1\u9762\u9019\u500B\u6771\u897F\u53EB <code>Block Kit</code>\uFF0C \u611F\u89BA\u53EF\u4EE5\u505A\u51FA\u5F88\u591A\u5143\u7684\u6771\u897F\uFF01\uFF01\u4F46...\u5982\u679C\u8981\u5FEB\u6377\u4E00\u9EDE\u53EF\u4EE5\u7528\u4E0B\u9762\u9019\u500B Builder \u8FC5\u901F\u532F\u5165\u6A21\u677F\u4F86\u4FEE\u6539\u6BD4\u8F03\u4E0D\u6703\u6D6A\u8CBB\u751F\u547D</p>`,4),hn={href:"https://app.slack.com/block-kit-builder/T92N97FNG",target:"_blank",rel:"noopener noreferrer"},kn=s("Slack Block Kit Builder"),_n=t(`<div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Post to a Slack channel
  <span class="token key atrule">id</span><span class="token punctuation">:</span> slack
  <span class="token key atrule">uses</span><span class="token punctuation">:</span> slackapi/slack<span class="token punctuation">-</span>github<span class="token punctuation">-</span>action@v1.16.0
  <span class="token key atrule">with</span><span class="token punctuation">:</span>
    <span class="token comment"># Slack channel id, channel name, or user id to post message.</span>
    <span class="token comment"># See also: https://api.slack.com/methods/chat.postMessage#channels</span>
    <span class="token key atrule">channel-id</span><span class="token punctuation">:</span> <span class="token string">&#39;CHANNEL_ID&#39;</span>
    <span class="token comment"># For posting a rich message using Block Kit</span>
    <span class="token key atrule">payload</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      {
        &quot;text&quot;: &quot;GitHub Action build result: \${{ job.status }}\\n\${{ github.event.pull_request.html_url || github.event.head_commit.url }}&quot;,
        &quot;blocks&quot;: [
          {
            &quot;type&quot;: &quot;section&quot;,
            &quot;text&quot;: {
              &quot;type&quot;: &quot;mrkdwn&quot;,
              &quot;text&quot;: &quot;GitHub Action build result: \${{ job.status }}\\n\${{ github.event.pull_request.html_url || github.event.head_commit.url }}&quot;
            }
          }
        ]
      }</span>
  <span class="token key atrule">env</span><span class="token punctuation">:</span>
    <span class="token key atrule">SLACK_BOT_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.SLACK_BOT_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><img src="`+m+`" alt=""></p><h3 id="\u6700\u5F8C\u9644\u4E0A\u6211\u7684\u7BC4\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u6700\u5F8C\u9644\u4E0A\u6211\u7684\u7BC4\u4F8B" aria-hidden="true">#</a> \u6700\u5F8C\u9644\u4E0A\u6211\u7684\u7BC4\u4F8B</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Post to a Slack channel
        <span class="token key atrule">id</span><span class="token punctuation">:</span> slack
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> slackapi/slack<span class="token punctuation">-</span>github<span class="token punctuation">-</span>action@v1.18.0
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token comment"># Slack channel id, channel name, or user id to post message.</span>
          <span class="token comment"># See also: https://api.slack.com/methods/chat.postMessage#channels</span>
          <span class="token key atrule">channel-id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span>secrets.SLACK_CHANNEL_ID<span class="token punctuation">}</span><span class="token punctuation">}</span>

          <span class="token comment"># For posting a simple plain text message</span>
          <span class="token comment"># slack-message: &#39;GitHub build result: \${{ job.status }}\\n\${{ github.event.pull_request.html_url || github.event.head_commit.url }}&#39;</span>

          <span class="token comment"># For posting a rich message using Block Kit</span>
          <span class="token key atrule">payload</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
            {
              &quot;blocks&quot;: [
                {
                  &quot;type&quot;: &quot;section&quot;,
                  &quot;text&quot;: {
                    &quot;type&quot;: &quot;mrkdwn&quot;,
                    &quot;text&quot;: &quot;\uFF3F\uFF3F\uFF3F\uFF3F\uFF3F has a new update:\\n*&lt;\${{secrets.SLACK_URL_PRODUCTION}}|Production&gt;*\\t*&lt;\${{secrets.SLACK_URL_STAGING}}|Staging&gt;*&quot;
                  }
                },
                {
                  &quot;type&quot;: &quot;section&quot;,
                  &quot;fields&quot;: [
                    {
                      &quot;type&quot;: &quot;mrkdwn&quot;,
                      &quot;text&quot;: &quot;*Branch:* \${{github.ref_name}}&quot;
                    },
                    {
                      &quot;type&quot;: &quot;mrkdwn&quot;,
                      &quot;text&quot;: &quot;*Build result:* \${{ job.status }}&quot;
                    },
                    {
                      &quot;type&quot;: &quot;mrkdwn&quot;,
                      &quot;text&quot;: &quot;*Repo:* \${{github.repository}}&quot;
                    },
                    {
                      &quot;type&quot;: &quot;mrkdwn&quot;,
                      &quot;text&quot;: &quot;*Actor:* \${{github.actor}}&quot;
                    },
                    {
                      &quot;type&quot;: &quot;mrkdwn&quot;,
                      &quot;text&quot;: &quot;*Compare:* \${{github.event.compare}}&quot;
                    }
                  ]
                }
              ]
            }</span>
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
          <span class="token key atrule">SLACK_BOT_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.SLACK_BOT_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div>`,4),dn=s("\u88E1\u9762\u6709\u9644\u4E0A\u4E00\u4E9B "),gn=n("code",null,"github action",-1),qn=s(" \u7279\u6709\u7684 "),yn=n("code",null,"context",-1),fn=s(" \u53EF\u4EE5\u5230 "),Sn={href:"https://docs.github.com/en/actions/learn-github-actions/contexts",target:"_blank",rel:"noopener noreferrer"},vn=s("github \u5B98\u7DB2\u770B\u6587\u4EF6");function xn(An,wn){const a=l("ExternalLinkIcon");return p(),c(u,null,[k,_,n("p",null,[d,n("a",g,[q,e(a)]),y,n("a",f,[S,e(a)]),v]),x,A,w,n("p",null,[N,n("a",T,[C,e(a)])]),K,B,O,$,n("p",null,[L,n("a",E,[G,e(a)]),I]),F,n("ul",null,[n("li",null,[n("a",H,[P,e(a)]),j,D,M,U,R]),n("li",null,[V,n("a",W,[J,e(a)]),X,Z,z,Q]),Y,n("li",null,[nn,sn,an,en,tn,n("a",on,[ln,e(a)]),pn,cn,un,rn]),bn]),mn,n("p",null,[n("a",hn,[kn,e(a)])]),_n,n("p",null,[dn,gn,qn,yn,fn,n("a",Sn,[vn,e(a)])])],64)}var Tn=o(h,[["render",xn]]);export{Tn as default};
